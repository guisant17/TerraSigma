// Title: Usage Of Web Request Commands And Cmdlets
// Author: James Pemberton / @4A616D6573, Endgame, JHasenbusch, oscd.community, Austin Songer @austinsonger
// Date: 2019-10-24
// Level: medium
// Description: Detects the use of various web request commands with commandline tools and Windows PowerShell cmdlets (including aliases) via CommandLine
// MITRE Tactic: Execution
// Tags: attack.execution, attack.t1059.001
// False Positives:
//   - Use of Get-Command and Get-Help modules to reference Invoke-WebRequest and Start-BitsTransfer.

DeviceProcessEvents
| where ProcessCommandLine contains "[System.Net.WebRequest]::create" or ProcessCommandLine contains "curl " or ProcessCommandLine contains "Invoke-RestMethod" or ProcessCommandLine contains "Invoke-WebRequest" or ProcessCommandLine contains " irm " or ProcessCommandLine contains "iwr " or ProcessCommandLine contains "Resume-BitsTransfer" or ProcessCommandLine contains "Start-BitsTransfer" or ProcessCommandLine contains "wget " or ProcessCommandLine contains "WinHttp.WinHttpRequest"