// Title: Suspicious Creation of .library-ms File — Potential CVE-2025-24054 Exploit
// Author: Gene Kazimiarovich
// Date: 2025-04-20
// Level: medium
// Description: Detects creation of '.library-ms' files, which may indicate exploitation of CVE-2025-24054. This vulnerability allows an attacker to trigger an automatic outbound SMB or WebDAV authentication request to a remote server upon archive extraction.
// If the system is unpatched, no user interaction is required beyond extracting a malicious archive—potentially exposing the user's NTLMv2-SSP hash to the attacker.
// MITRE Tactic: Credential Access
// Tags: detection.emerging-threats, attack.credential-access, attack.t1187, cve.2025-24054
// False Positives:
//   - Legitimate Library shortcuts under %APPDATA%\Microsoft\Windows\Libraries\ (rarely created by end-users)
//   - Custom corporate scripts that programmatically generate .library-ms Files

DeviceFileEvents
| where (InitiatingProcessFolderPath endswith "\\7z.exe" or InitiatingProcessFolderPath endswith "\\winrar.exe" or InitiatingProcessFolderPath endswith "\\explorer.exe") and FolderPath endswith ".library-ms"