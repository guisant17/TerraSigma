// Title: Potential CVE-2022-26809 Exploitation Attempt
// Author: Florian Roth (Nextron Systems)
// Date: 2022-04-13
// Level: high
// Description: Detects suspicious remote procedure call (RPC) service anomalies based on the spawned sub processes (long shot to detect the exploitation of vulnerabilities like CVE-2022-26809)
// MITRE Tactic: Initial Access
// Tags: attack.initial-access, attack.t1190, attack.execution, attack.t1569.002, cve.2022-26809, detection.emerging-threats
// False Positives:
//   - Some cases in which the service spawned a werfault.exe process

DeviceProcessEvents
| where InitiatingProcessCommandLine contains "-k RPCSS" and InitiatingProcessFolderPath =~ "C:\\Windows\\System32\\svchost.exe"