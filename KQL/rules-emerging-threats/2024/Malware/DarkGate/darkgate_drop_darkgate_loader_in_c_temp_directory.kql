// Title: DarkGate - Drop DarkGate Loader In C:\Temp Directory
// Author: Tomasz Dyduch, Josh Nickels
// Date: 2024-05-31
// Level: medium
// Description: Detects attackers attempting to save, decrypt and execute the DarkGate Loader in C:\temp folder.
// MITRE Tactic: Execution
// Tags: attack.execution, attack.t1059, detection.emerging-threats
// False Positives:
//   - Unlikely legitimate usage of AutoIT in temp folders.

DeviceFileEvents
| where (FolderPath contains ":\\temp\\" and (FolderPath endswith ".au3" or FolderPath endswith "\\autoit3.exe")) or (InitiatingProcessFolderPath contains ":\\temp\\" and (InitiatingProcessFolderPath endswith ".au3" or InitiatingProcessFolderPath endswith "\\autoit3.exe"))