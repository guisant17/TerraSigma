// Title: PaperCut MF/NG Potential Exploitation
// Author: Nasreddine Bencherchali (Nextron Systems), Huntress DE&TH Team (idea)
// Date: 2023-04-20
// Level: high
// Description: Detects suspicious child processes of "pc-app.exe". Which could indicate potential exploitation of PaperCut
// MITRE Tactic: Execution
// Tags: attack.execution, detection.emerging-threats
// False Positives:
//   - Legitimate administration activity

DeviceProcessEvents
| where (FolderPath endswith "\\bash.exe" or FolderPath endswith "\\calc.exe" or FolderPath endswith "\\certutil.exe" or FolderPath endswith "\\cmd.exe" or FolderPath endswith "\\csc.exe" or FolderPath endswith "\\cscript.exe" or FolderPath endswith "\\dllhost.exe" or FolderPath endswith "\\mshta.exe" or FolderPath endswith "\\msiexec.exe" or FolderPath endswith "\\powershell.exe" or FolderPath endswith "\\pwsh.exe" or FolderPath endswith "\\regsvr32.exe" or FolderPath endswith "\\rundll32.exe" or FolderPath endswith "\\scriptrunner.exe" or FolderPath endswith "\\wmic.exe" or FolderPath endswith "\\wscript.exe" or FolderPath endswith "\\wsl.exe") and InitiatingProcessFolderPath endswith "\\pc-app.exe"