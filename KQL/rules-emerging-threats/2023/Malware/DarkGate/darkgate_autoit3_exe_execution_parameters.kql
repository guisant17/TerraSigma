// Title: DarkGate - Autoit3.EXE Execution Parameters
// Author: Micah Babinski
// Date: 2023-10-15
// Level: high
// Description: Detects execution of the legitimate Autoit3 utility from a suspicious parent process. AutoIt3.exe is used within
// the DarkGate infection chain to execute shellcode that performs process injection and connects to the DarkGate
// command-and-control server.
// MITRE Tactic: Execution
// Tags: attack.execution, attack.t1059, detection.emerging-threats
// False Positives:
//   - Unlikely

DeviceProcessEvents
| where ((InitiatingProcessFolderPath endswith "\\cmd.exe" or InitiatingProcessFolderPath endswith "\\KeyScramblerLogon.exe" or InitiatingProcessFolderPath endswith "\\msiexec.exe") and (FolderPath endswith "\\Autoit3.exe" or ProcessVersionInfoOriginalFileName =~ "AutoIt3.exe")) and (not((FolderPath endswith ":\\Program Files (x86)\\AutoIt3\\AutoIt3.exe" or FolderPath endswith ":\\Program Files\\AutoIt3\\AutoIt3.exe")))