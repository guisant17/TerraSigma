// Title: ScreenConnect User Database Modification
// Author: Matt Anderson, Andrew Schwartz, Caleb Stewart, Huntress
// Date: 2024-02-21
// Level: medium
// Description: Detects file modifications to the temporary xml user database file indicating local user modification in the ScreenConnect server.
// This will occur during exploitation of the ScreenConnect Authentication Bypass vulnerability (CVE-2024-1709) in versions <23.9.8, but may also be observed when making legitimate modifications to local users or permissions.
// MITRE Tactic: Persistence
// Tags: attack.persistence, cve.2024-1709, detection.emerging-threats
// False Positives:
//   - This will occur legitimately as well and will result in some benign activity.

DeviceFileEvents
| where InitiatingProcessFolderPath endswith "\\ScreenConnect.Service.exe" and (FolderPath contains "Temp" and FolderPath contains "ScreenConnect") and FolderPath endswith ".xml"