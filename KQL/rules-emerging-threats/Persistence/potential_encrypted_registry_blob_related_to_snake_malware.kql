// Title: Potential Encrypted Registry Blob Related To SNAKE Malware
// Author: Nasreddine Bencherchali (Nextron Systems)
// Date: 2023-05-10
// Level: medium
// Description: Detects the creation of a registry value in the ".wav\OpenWithProgIds" key with an uncommon name. This could be related to SNAKE Malware as reported by CISA
// MITRE Tactic: Persistence
// Tags: attack.persistence, detection.emerging-threats
// False Positives:
//   - Some additional tuning might be required to tune out legitimate processes that write to this key by default

DeviceRegistryEvents
| where RegistryKey endswith "\\SOFTWARE\\Classes\\.wav\\OpenWithProgIds*" and (not((RegistryKey endswith ".AssocFile.WAV" or RegistryKey contains ".wav.")))