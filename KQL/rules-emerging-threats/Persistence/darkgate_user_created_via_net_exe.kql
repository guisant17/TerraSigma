// Title: DarkGate - User Created Via Net.EXE
// Author: X__Junior (Nextron Systems)
// Date: 2023-08-27
// Level: high
// Description: Detects creation of local users via the net.exe command with the name of "DarkGate"
// MITRE Tactic: Persistence
// Tags: attack.persistence, attack.t1136.001, detection.emerging-threats
// False Positives:
//   - Unlikely

DeviceProcessEvents
| where (ProcessCommandLine contains "user" and ProcessCommandLine contains "add" and ProcessCommandLine contains "DarkGate" and ProcessCommandLine contains "SafeMode") and (FolderPath endswith "\\net.exe" or FolderPath endswith "\\net1.exe")