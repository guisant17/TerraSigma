// Title: Potential Conti Ransomware Database Dumping Activity Via SQLCmd
// Author: frack113
// Date: 2021-08-16
// Level: high
// Description: Detects a command used by conti to dump database
// MITRE Tactic: Collection
// Tags: attack.collection, attack.t1005, detection.emerging-threats

DeviceProcessEvents
| where (ProcessCommandLine contains "sys.sysprocesses" or ProcessCommandLine contains "master.dbo.sysdatabases" or ProcessCommandLine contains "BACKUP DATABASE") and ProcessCommandLine contains " -S localhost " and (FolderPath endswith "\\sqlcmd.exe" or (ProcessCommandLine contains "sqlcmd " or ProcessCommandLine contains "sqlcmd.exe"))