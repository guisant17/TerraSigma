// Title: Potential Devil Bait Malware Reconnaissance
// Author: Nasreddine Bencherchali (Nextron Systems), NCSC (Idea)
// Date: 2023-05-15
// Level: high
// Description: Detects specific process behavior observed with Devil Bait samples
// MITRE Tactic: Defense Evasion
// Tags: attack.defense-evasion, attack.t1218, detection.emerging-threats
// False Positives:
//   - Unlikely

DeviceProcessEvents
| where (ProcessCommandLine matches regex "ipconfig\\s+/all" or (ProcessCommandLine contains "dir" or ProcessCommandLine contains "systeminfo" or ProcessCommandLine contains "tasklist")) and (ProcessCommandLine contains ">>%APPDATA%\\Microsoft\\" and (ProcessCommandLine endswith ".xml" or ProcessCommandLine endswith ".txt") and FolderPath endswith "\\cmd.exe" and InitiatingProcessFolderPath endswith "\\wscript.exe")