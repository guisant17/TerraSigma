// Title: Potential Atlassian Confluence CVE-2021-26084 Exploitation Attempt
// Author: Bhabesh Raj
// Date: 2021-09-08
// Level: high
// Description: Detects spawning of suspicious child processes by Atlassian Confluence server which may indicate successful exploitation of CVE-2021-26084
// MITRE Tactic: Initial Access
// Tags: attack.initial-access, attack.execution, attack.t1190, attack.t1059, cve.2021-26084, detection.emerging-threats

DeviceProcessEvents
| where (ProcessCommandLine contains "certutil" or ProcessCommandLine contains "cmd /c" or ProcessCommandLine contains "cmd /k" or ProcessCommandLine contains "cscript" or ProcessCommandLine contains "curl" or ProcessCommandLine contains "ipconfig" or ProcessCommandLine contains "powershell" or ProcessCommandLine contains "pwsh" or ProcessCommandLine contains "regsvr32" or ProcessCommandLine contains "rundll32" or ProcessCommandLine contains "whoami" or ProcessCommandLine contains "wscript") and InitiatingProcessFolderPath endswith "\\Atlassian\\Confluence\\jre\\bin\\java.exe"