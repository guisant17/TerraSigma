// Title: CVE-2023-22518 Exploitation Attempt - Suspicious Confluence Child Process (Linux)
// Author: Andreas Braathen (mnemonic.io)
// Date: 2023-11-14
// Level: high
// Description: Detects exploitation attempt of CVE-2023-22518 (Confluence Data Center / Confluence Server), where an attacker can exploit vulnerable endpoints to e.g. create admin accounts and execute arbitrary commands.
// MITRE Tactic: Execution
// Tags: attack.execution, attack.t1059, attack.initial-access, attack.t1190, cve.2023-22518, detection.emerging-threats
// False Positives:
//   - Unlikely

DeviceProcessEvents
| where ((FolderPath endswith "/bash" or FolderPath endswith "/curl" or FolderPath endswith "/echo" or FolderPath endswith "/wget") and (InitiatingProcessCommandLine contains "confluence" and InitiatingProcessFolderPath endswith "/java")) and (not(ProcessCommandLine contains "ulimit -u"))