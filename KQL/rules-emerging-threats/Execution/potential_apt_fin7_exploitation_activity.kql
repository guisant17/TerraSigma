// Title: Potential APT FIN7 Exploitation Activity
// Author: Alex Walston (@4ayymm)
// Date: 2024-07-29
// Level: medium
// Description: Detects potential APT FIN7 exploitation activity as reported by Google.
// In order to obtain initial access, FIN7 used compromised Remote Desktop Protocol (RDP) credentials to login to a target server and initiate specific Windows process chains.
// MITRE Tactic: Execution
// Tags: attack.execution, attack.t1059.001, attack.t1059.003, detection.emerging-threats
// False Positives:
//   - Notepad++ can legitimately spawn cmd (Open Containing Folder in CMD)

DeviceProcessEvents
| where (FolderPath endswith "\\cmd.exe" and InitiatingProcessFolderPath endswith "\\notepad++.exe") or (FolderPath endswith "\\notepad++.exe" and InitiatingProcessFolderPath endswith "\\rdpinit.exe")