// Title: PaperCut MF/NG Exploitation Related Indicators
// Author: Nasreddine Bencherchali (Nextron Systems)
// Date: 2023-04-25
// Level: high
// Description: Detects exploitation indicators related to PaperCut MF/NG Exploitation
// MITRE Tactic: Execution
// Tags: attack.execution, detection.emerging-threats
// False Positives:
//   - Unlikely

DeviceProcessEvents
| where (ProcessCommandLine contains " /c " and ProcessCommandLine contains "powershell" and ProcessCommandLine contains "-nop -w hidden" and ProcessCommandLine contains "Invoke-WebRequest" and ProcessCommandLine contains "setup.msi" and ProcessCommandLine contains "-OutFile") or (ProcessCommandLine contains "msiexec " and ProcessCommandLine contains "/i " and ProcessCommandLine contains "setup.msi " and ProcessCommandLine contains "/qn " and ProcessCommandLine contains "IntegratorLogin=fimaribahundq")