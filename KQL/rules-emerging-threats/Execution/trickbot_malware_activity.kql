// Title: Trickbot Malware Activity
// Author: Florian Roth (Nextron Systems)
// Date: 2020-11-26
// Level: high
// Description: Detects Trickbot malware process tree pattern in which "rundll32.exe" is a parent of "wermgr.exe"
// MITRE Tactic: Execution
// Tags: attack.execution, attack.t1559, detection.emerging-threats

DeviceProcessEvents
| where FolderPath endswith "\\wermgr.exe" and InitiatingProcessCommandLine contains "DllRegisterServer" and InitiatingProcessFolderPath endswith "\\rundll32.exe"