// Title: SNAKE Malware WerFault Persistence File Creation
// Author: Nasreddine Bencherchali (Nextron Systems)
// Date: 2023-05-10
// Level: high
// Description: Detects the creation of a file named "WerFault.exe" in the WinSxS directory by a non-system process, which can be indicative of potential SNAKE malware activity
// MITRE Tactic: Execution
// Tags: attack.execution, detection.emerging-threats

DeviceFileEvents
| where (FolderPath endswith "\\WerFault.exe" and FolderPath startswith "C:\\Windows\\WinSxS\\") and (not((InitiatingProcessFolderPath startswith "C:\\Windows\\System32\\" or InitiatingProcessFolderPath startswith "C:\\Windows\\SysWOW64\\" or InitiatingProcessFolderPath startswith "C:\\Windows\\WinSxS\\")))