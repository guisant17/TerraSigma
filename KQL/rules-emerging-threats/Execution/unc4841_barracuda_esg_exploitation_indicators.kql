// Title: UNC4841 - Barracuda ESG Exploitation Indicators
// Author: Nasreddine Bencherchali (Nextron Systems)
// Date: 2023-06-16
// Level: high
// Description: Detects file indicators as seen used by UNC4841 during their Barracuda ESG zero day exploitation.
// MITRE Tactic: Execution
// Tags: attack.execution, attack.persistence, attack.defense-evasion, detection.emerging-threats
// False Positives:
//   - Unlikely

DeviceFileEvents
| where FolderPath endswith "/11111.tar" or FolderPath endswith "/aacore.sh" or FolderPath endswith "/appcheck.sh" or FolderPath endswith "/autoins" or FolderPath endswith "/BarracudaMailService" or FolderPath endswith "/etc/cron.daily/core_check.sh" or FolderPath endswith "/etc/cron.daily/core.sh" or FolderPath endswith "/etc/cron.hourly/aacore.sh" or FolderPath endswith "/etc/cron.hourly/appcheck.sh" or FolderPath endswith "/etc/cron.hourly/core.sh" or FolderPath endswith "/get_fs_info.pl" or FolderPath endswith "/imgdata.jpg" or FolderPath endswith "/install_att_v2.tar" or FolderPath endswith "/install_bvp74_auth.tar" or FolderPath endswith "/install_helo.tar" or FolderPath endswith "/install_reuse.tar" or FolderPath endswith "/intent_helo" or FolderPath endswith "/intent_reuse" or FolderPath endswith "/intentbas" or FolderPath endswith "/mod_attachment.lua" or FolderPath endswith "/mod_content.lua" or FolderPath endswith "/mod_require_helo.lua" or FolderPath endswith "/mod_rtf" or FolderPath endswith "/mod_sender.lua" or FolderPath endswith "/mod_udp.so" or FolderPath endswith "/nfsd_stub.ko" or FolderPath endswith "/resize_reisertab" or FolderPath endswith "/resize_risertab" or FolderPath endswith "/resize2fstab" or FolderPath endswith "/rverify" or FolderPath endswith "/saslautchd" or FolderPath endswith "/sendscd" or FolderPath endswith "/snapshot.tar" or FolderPath endswith "/tmp/p" or FolderPath endswith "/tmp/p7" or FolderPath endswith "/tmp/t" or FolderPath endswith "/update_v2.sh" or FolderPath endswith "/update_v31.sh" or FolderPath endswith "/update_v35.sh" or FolderPath endswith "/update_version"