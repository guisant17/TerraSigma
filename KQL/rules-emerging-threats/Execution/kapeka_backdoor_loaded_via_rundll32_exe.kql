// Title: Kapeka Backdoor Loaded Via Rundll32.EXE
// Author: Swachchhanda Shrawan Poudel
// Date: 2024-07-03
// Level: high
// Description: Detects the Kapeka Backdoor binary being loaded by rundll32.exe.
// The Kapeka loader drops a backdoor, which is a DLL with the '.wll' extension masquerading as a Microsoft Word Add-In.
// MITRE Tactic: Execution
// Tags: attack.execution, attack.t1204.002, attack.defense-evasion, attack.t1218.011, detection.emerging-threats

DeviceImageLoadEvents
| where (FolderPath contains ":\\ProgramData" or FolderPath contains "\\AppData\\Local\\") and FolderPath matches regex "[a-zA-Z]{5,6}\\.wll" and InitiatingProcessFolderPath endswith "\\rundll32.exe"