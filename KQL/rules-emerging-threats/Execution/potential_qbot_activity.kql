// Title: Potential QBot Activity
// Author: Florian Roth (Nextron Systems)
// Date: 2019-10-01
// Level: critical
// Description: Detects potential QBot activity by looking for process executions used previously by QBot
// MITRE Tactic: Execution
// Tags: attack.execution, attack.t1059.005, detection.emerging-threats
// False Positives:
//   - Unlikely

DeviceProcessEvents
| where (FolderPath endswith "\\wscript.exe" and InitiatingProcessFolderPath endswith "\\WinRAR.exe") or ProcessCommandLine contains " /c ping.exe -n 6 127.0.0.1 & type " or (ProcessCommandLine contains "regsvr32.exe" and ProcessCommandLine contains "C:\\ProgramData" and ProcessCommandLine contains ".tmp")