// Title: Potential Exploitation of CrushFTP RCE Vulnerability (CVE-2025-54309)
// Author: Nisarg Suthar
// Date: 2025-08-01
// Level: high
// Description: Detects suspicious child processes created by CrushFTP. It could be an indication of exploitation of a RCE vulnerability such as CVE-2025-54309.
// MITRE Tactic: Privilege Escalation
// Tags: attack.privilege-escalation, attack.initial-access, attack.execution, attack.t1059.001, attack.t1059.003, attack.t1068, attack.t1190, cve.2025-54309, detection.emerging-threats
// False Positives:
//   - Legitimate administrative command execution

DeviceProcessEvents
| where InitiatingProcessFolderPath endswith "\\crushftp.exe" and (((ProcessCommandLine contains "/c powershell" or ProcessCommandLine contains "whoami" or ProcessCommandLine contains "net.exe" or ProcessCommandLine contains "net1.exe") and FolderPath endswith "\\cmd.exe") or (FolderPath endswith "\\bitsadmin.exe" or FolderPath endswith "\\certutil.exe" or FolderPath endswith "\\mshta.exe" or FolderPath endswith "\\cscript.exe" or FolderPath endswith "\\wscript.exe") or ((ProcessCommandLine contains "IEX" and ProcessCommandLine contains "enc" and ProcessCommandLine contains "Hidden" and ProcessCommandLine contains "bypass") and (FolderPath endswith "\\powershell.exe" or FolderPath endswith "\\powershell_ise.exe" or FolderPath endswith "\\pwsh.exe")))