// Title: Potential Exploitation of CVE-2024-3094 - Suspicious SSH Child Process
// Author: Arnim Rupp, Nasreddine Bencherchali, Thomas Patzke
// Date: 2024-04-01
// Level: high
// Description: Detects potentially suspicious child process of SSH process (sshd) with a specific execution user. This could be a sign of potential exploitation of CVE-2024-3094.
// MITRE Tactic: Execution
// Tags: attack.execution, cve.2024-3094, detection.emerging-threats
// False Positives:
//   - Administrative activity directly with root authentication might trigger this rule if it's unnecessarily prefixed with "sh -c" or "bash -c"

DeviceProcessEvents
| where (ProcessCommandLine startswith "bash -c" or ProcessCommandLine startswith "sh -c") and InitiatingProcessFolderPath endswith "/sshd" and AccountName =~ "root"