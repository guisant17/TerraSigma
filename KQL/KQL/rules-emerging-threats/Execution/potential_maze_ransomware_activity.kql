// Title: Potential Maze Ransomware Activity
// Author: Florian Roth (Nextron Systems)
// Date: 2020-05-08
// Level: critical
// Description: Detects specific process characteristics of Maze ransomware word document droppers
// MITRE Tactic: Execution
// Tags: attack.execution, attack.t1204.002, attack.t1047, attack.impact, attack.t1490, detection.emerging-threats
// False Positives:
//   - Unlikely

DeviceProcessEvents
| where (FolderPath endswith ".tmp" and InitiatingProcessFolderPath endswith "\\WINWORD.exe") or (ProcessCommandLine endswith "shadowcopy delete" and FolderPath endswith "\\wmic.exe" and InitiatingProcessFolderPath contains "\\Temp\\") or (ProcessCommandLine contains "\\..\\..\\system32" and ProcessCommandLine endswith "shadowcopy delete")