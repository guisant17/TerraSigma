// Title: CVE-2023-38331 Exploitation Attempt - Suspicious Double Extension File
// Author: Nasreddine Bencherchali (Nextron Systems)
// Date: 2023-08-30
// Level: high
// Description: Detects the creation of a file with a double extension and a space by WinRAR. This could be a sign of exploitation of CVE-2023-38331
// MITRE Tactic: Execution
// Tags: attack.execution, cve.2023-38331, detection.emerging-threats

DeviceFileEvents
| where InitiatingProcessFolderPath endswith "\\WinRAR.exe" and FolderPath contains "\\AppData\\Local\\Temp\\Rar$" and FolderPath matches regex "\\.[a-zA-Z0-9]{1,4} \\."