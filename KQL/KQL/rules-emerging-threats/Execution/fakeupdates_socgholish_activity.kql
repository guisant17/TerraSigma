// Title: FakeUpdates/SocGholish Activity
// Author: @kostastsale
// Date: 2022-06-16
// Level: high
// Description: Detects initial execution of FakeUpdates/SocGholish malware via wscript that later executes commands via cmd or powershell.
// MITRE Tactic: Execution
// Tags: attack.execution, attack.t1059.001, detection.emerging-threats
// False Positives:
//   - Unlikely

DeviceProcessEvents
| where (FolderPath endswith "\\cmd.exe" or FolderPath endswith "\\powershell.exe" or FolderPath endswith "\\pwsh.exe") and (InitiatingProcessCommandLine contains "Chrome" or InitiatingProcessCommandLine contains "Edge" or InitiatingProcessCommandLine contains "Firefox" or InitiatingProcessCommandLine contains "Opera" or InitiatingProcessCommandLine contains "Brave" or InitiatingProcessCommandLine contains "Vivaldi") and (InitiatingProcessCommandLine contains "\\AppData\\Local\\Temp" and InitiatingProcessCommandLine contains ".zip" and InitiatingProcessCommandLine contains "update" and InitiatingProcessCommandLine contains ".js") and InitiatingProcessFolderPath endswith "\\wscript.exe"