// Title: Raspberry Robin Subsequent Execution of Commands
// Author: @kostastsale
// Date: 2022-05-06
// Level: high
// Description: Detects raspberry robin subsequent execution of commands.
// MITRE Tactic: Execution
// Tags: attack.execution, attack.t1059.001, detection.emerging-threats
// False Positives:
//   - Unlikely

DeviceProcessEvents
| where (ProcessCommandLine contains "installdriver" or ProcessCommandLine contains "setfiledsndir" or ProcessCommandLine contains "vkipdse") and (ProcessCommandLine contains "odbcconf.exe" and ProcessCommandLine contains "regsvr" and ProcessCommandLine contains "shellexec_rundll") and (ProcessCommandLine endswith "-a" or ProcessCommandLine endswith "/a" or ProcessCommandLine endswith "–a" or ProcessCommandLine endswith "—a" or ProcessCommandLine endswith "―a" or ProcessCommandLine endswith "-f" or ProcessCommandLine endswith "/f" or ProcessCommandLine endswith "–f" or ProcessCommandLine endswith "—f" or ProcessCommandLine endswith "―f" or ProcessCommandLine endswith "-s" or ProcessCommandLine endswith "/s" or ProcessCommandLine endswith "–s" or ProcessCommandLine endswith "—s" or ProcessCommandLine endswith "―s") and (FolderPath endswith "\\rundll32.exe" or FolderPath endswith "\\regsvr32.exe") and InitiatingProcessFolderPath endswith "\\fodhelper.exe"