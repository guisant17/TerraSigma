// Title: Potential Exploitation Attempt Of Undocumented WindowsServer RCE
// Author: Florian Roth (Nextron Systems), Nasreddine Bencherchali
// Date: 2023-01-21
// Level: high
// Description: Detects potential exploitation attempt of undocumented Windows Server Pre Auth Remote Code Execution (RCE)
// MITRE Tactic: Initial Access
// Tags: attack.initial-access, attack.t1190, detection.emerging-threats

DeviceProcessEvents
| where ProcessCommandLine contains "-k DHCPServer" and FolderPath endswith "\\svchost.exe" and InitiatingProcessCommandLine contains "-k DHCPServer" and InitiatingProcessFolderPath endswith "\\svchost.exe" and (AccountName contains "NETWORK SERVICE" or AccountName contains "NETZWERKDIENST" or AccountName contains "SERVIZIO DI RETE" or AccountName contains "SERVICIO DE RED")