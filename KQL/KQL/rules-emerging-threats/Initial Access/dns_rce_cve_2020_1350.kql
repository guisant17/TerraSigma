// Title: DNS RCE CVE-2020-1350
// Author: Florian Roth (Nextron Systems)
// Date: 2020-07-15
// Level: critical
// Description: Detects exploitation of DNS RCE bug reported in CVE-2020-1350 by the detection of suspicious sub process
// MITRE Tactic: Initial Access
// Tags: attack.initial-access, attack.t1190, attack.execution, attack.t1569.002, cve.2020-1350, detection.emerging-threats
// False Positives:
//   - Unknown but benign sub processes of the Windows DNS service dns.exe

DeviceProcessEvents
| where InitiatingProcessFolderPath endswith "\\System32\\dns.exe" and (not((FolderPath endswith "\\System32\\werfault.exe" or FolderPath endswith "\\System32\\conhost.exe" or FolderPath endswith "\\System32\\dnscmd.exe" or FolderPath endswith "\\System32\\dns.exe")))