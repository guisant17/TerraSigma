// Title: Exploiting CVE-2019-1388
// Author: Florian Roth (Nextron Systems)
// Date: 2019-11-20
// Level: critical
// Description: Detects an exploitation attempt in which the UAC consent dialogue is used to invoke an Internet Explorer process running as LOCAL_SYSTEM
// MITRE Tactic: Privilege Escalation
// Tags: attack.privilege-escalation, attack.t1068, cve.2019-1388, detection.emerging-threats

DeviceProcessEvents
| where (ProcessCommandLine contains " http" and FolderPath endswith "\\iexplore.exe" and InitiatingProcessFolderPath endswith "\\consent.exe") and ((ProcessIntegrityLevel in~ ("System", "S-1-16-16384")) or (AccountName contains "AUTHORI" or AccountName contains "AUTORI"))