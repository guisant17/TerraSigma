// Title: Exploitation Activity of CVE-2025-59287 - WSUS Suspicious Child Process
// Author: Huntress Labs, Swachchhanda Shrawan Poudel (Nextron Systems)
// Date: 2025-10-31
// Level: high
// Description: Detects the creation of command-line interpreters (cmd.exe, powershell.exe) as child processes of Windows Server Update Services (WSUS) related process wsusservice.exe.
// This behavior is a key indicator of exploitation for the critical remote code execution vulnerability such as CVE-2025-59287, where attackers spawn shells to conduct reconnaissance and further post-exploitation activities.
// MITRE Tactic: Execution
// Tags: attack.execution, attack.initial-access, attack.t1190, attack.t1203, cve.2025-59287, detection.emerging-threats
// False Positives:
//   - If this activity is expected, consider filtering based on specific command lines, user context (e.g., `nt authority\network service`), or parent process command lines to reduce noise.

DeviceProcessEvents
| where ((InitiatingProcessCommandLine contains "WsusPool" and InitiatingProcessFolderPath endswith "\\w3wp.exe") or InitiatingProcessFolderPath endswith "\\wsusservice.exe") and (FolderPath endswith "\\cmd.exe" or FolderPath endswith "\\powershell.exe" or FolderPath endswith "\\pwsh.exe" or FolderPath endswith "\\powershell_ise.exe")