// Title: Suspicious Scheduled Task Name As GUID
// Author: Nasreddine Bencherchali (Nextron Systems)
// Date: 2022-10-31
// Level: medium
// Description: Detects creation of a scheduled task with a GUID like name
// MITRE Tactic: Privilege Escalation
// Tags: attack.privilege-escalation, attack.persistence, attack.execution, attack.t1053.005
// False Positives:
//   - Legitimate software naming their tasks as GUIDs

DeviceProcessEvents
| where (ProcessCommandLine contains "}\"" or ProcessCommandLine contains "}'" or ProcessCommandLine contains "} ") and (ProcessCommandLine contains "/Create " and FolderPath endswith "\\schtasks.exe") and (ProcessCommandLine contains "/TN \"{" or ProcessCommandLine contains "/TN '{" or ProcessCommandLine contains "/TN {")