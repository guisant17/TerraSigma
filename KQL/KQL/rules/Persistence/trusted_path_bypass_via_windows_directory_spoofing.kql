// Title: Trusted Path Bypass via Windows Directory Spoofing
// Author: Swachchhanda Shrawan Poudel (Nextron Systems)
// Date: 2025-06-17
// Level: high
// Description: Detects DLLs loading from a spoofed Windows directory path with an extra space (e.g "C:\Windows \System32") which can bypass Windows trusted path verification.
// This technique tricks Windows into treating the path as trusted, allowing malicious DLLs to load with high integrity privileges bypassing UAC.
// MITRE Tactic: Persistence
// Tags: attack.persistence, attack.defense-evasion, attack.privilege-escalation, attack.t1574.007, attack.t1548.002
// False Positives:
//   - Unlikely

DeviceImageLoadEvents
| where FolderPath contains ":\\Windows \\System32\\" or FolderPath contains ":\\Windows \\SysWOW64\\"