// Title: Potentially Suspicious JWT Token Search Via CLI
// Author: Nasreddine Bencherchali (Nextron Systems), kagebunsher
// Date: 2022-10-25
// Level: medium
// Description: Detects potentially suspicious search for JWT tokens via CLI by looking for the string "eyJ0eX" or "eyJhbG".
// JWT tokens are often used for access-tokens across various applications and services like Microsoft 365, Azure, AWS, Google Cloud, and others.
// Threat actors may search for these tokens to steal them for lateral movement or privilege escalation.
// MITRE Tactic: Credential Access
// Tags: attack.credential-access, attack.t1528, attack.t1552.001

DeviceProcessEvents
| where (ProcessCommandLine contains "eyJ0eXAiOi" or ProcessCommandLine contains "eyJhbGciOi" or ProcessCommandLine contains " eyJ0eX" or ProcessCommandLine contains " \"eyJ0eX\"" or ProcessCommandLine contains " 'eyJ0eX'" or ProcessCommandLine contains " eyJhbG" or ProcessCommandLine contains " \"eyJhbG\"" or ProcessCommandLine contains " 'eyJhbG'") and (ProcessCommandLine contains "find " or ProcessCommandLine contains "find.exe" or ProcessCommandLine contains "findstr" or ProcessCommandLine contains "select-string " or ProcessCommandLine contains "strings")