// Title: Potential File Extension Spoofing Using Right-to-Left Override
// Author: Jonathan Peters (Nextron Systems), Florian Roth (Nextron Systems), Swachchhanda Shrawan Poudel (Nextron Systems)
// Date: 2024-11-17
// Level: high
// Description: Detects suspicious filenames that contain a right-to-left override character and a potentially spoofed file extensions.
// MITRE Tactic: Execution
// Tags: attack.execution, attack.defense-evasion, attack.t1036.002
// False Positives:
//   - Filenames that contains scriptures such as arabic or hebrew might make use of this character

DeviceFileEvents
| where (FolderPath contains "3pm." or FolderPath contains "4pm." or FolderPath contains "cod." or FolderPath contains "fdp." or FolderPath contains "ftr." or FolderPath contains "gepj." or FolderPath contains "gnp." or FolderPath contains "gpj." or FolderPath contains "ism." or FolderPath contains "lmth." or FolderPath contains "nls." or FolderPath contains "piz." or FolderPath contains "slx." or FolderPath contains "tdo." or FolderPath contains "vsc." or FolderPath contains "vwm." or FolderPath contains "xcod." or FolderPath contains "xslx." or FolderPath contains "xtpp.") and (FolderPath contains "\\u202e" or FolderPath contains "[U+202E]")