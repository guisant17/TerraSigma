id: 76c53599-801a-58b2-a42a-daca3780c93b
name: CVE-2020-1048 Exploitation Attempt - Suspicious New Printer Ports - Registry
description: Detects changes to the "Ports" registry key with data that includes a Windows path or a file with a suspicious extension. This could be an attempt to exploit CVE-2020-1048 - a Windows Print Spooler elevation of privilege vulnerability. - New printer port install on host
severity: High
queryFrequency: PT1H
queryPeriod: PT1H
triggerOperator: gt
triggerThreshold: 0
tactics:
- Persistence
- Execution
- DefenseEvasion
query: |-
  DeviceRegistryEvents
  | where (RegistryValueData contains ".bat" or RegistryValueData contains ".com" or RegistryValueData contains ".dll" or RegistryValueData contains ".exe" or RegistryValueData contains ".ps1" or RegistryValueData contains ".vbe" or RegistryValueData contains ".vbs" or RegistryValueData contains "C:") and RegistryKey contains "\\Microsoft\\Windows NT\\CurrentVersion\\Ports"
version: 1.0.0
kind: Scheduled
relevantTechniques:
- T1112
entityMappings:
- entityType: RegistryKey
  fieldMappings:
  - identifier: Key
    columnName: RegistryKey
  - identifier: ValueData
    columnName: RegistryValueData
requiredDataConnectors:
- connectorId: MicrosoftThreatProtection
  dataTypes:
  - DeviceRegistryEvents
