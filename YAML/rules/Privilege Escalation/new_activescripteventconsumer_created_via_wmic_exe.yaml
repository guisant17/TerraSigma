id: 7ea345d6-1bd5-5b9f-9e19-22932b21d543
name: New ActiveScriptEventConsumer Created Via Wmic.EXE
description: Detects WMIC executions in which an event consumer gets created. This could be used to establish persistence - Legitimate software creating script event consumers
severity: High
queryFrequency: PT1H
queryPeriod: PT1H
triggerOperator: gt
triggerThreshold: 0
tactics:
- PrivilegeEscalation
- Persistence
query: |-
  DeviceProcessEvents
  | where ProcessCommandLine contains "ActiveScriptEventConsumer" and ProcessCommandLine contains " CREATE "
version: 1.0.0
kind: Scheduled
relevantTechniques:
- T1546
entityMappings:
- entityType: Process
  fieldMappings:
  - identifier: CommandLine
    columnName: ProcessCommandLine
requiredDataConnectors:
- connectorId: MicrosoftThreatProtection
  dataTypes:
  - DeviceProcessEvents
