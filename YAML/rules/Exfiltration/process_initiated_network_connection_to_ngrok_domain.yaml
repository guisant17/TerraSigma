id: 4aab85a4-ce85-5b11-aacc-cc19d866e0b5
name: Process Initiated Network Connection To Ngrok Domain
description: Detects an executable initiating a network connection to "ngrok" domains. Attackers were seen using this "ngrok" in order to store their second stage payloads and malware. While communication with such domains can be legitimate, often times is a sign of either data exfiltration by malicious actors or additional download. - Legitimate use of the ngrok service.
severity: High
queryFrequency: PT1H
queryPeriod: PT1H
triggerOperator: gt
triggerThreshold: 0
tactics:
- Exfiltration
- CommandAndControl
query: |-
  DeviceNetworkEvents
  | where RemoteUrl endswith ".ngrok-free.app" or RemoteUrl endswith ".ngrok-free.dev" or RemoteUrl endswith ".ngrok.app" or RemoteUrl endswith ".ngrok.dev" or RemoteUrl endswith ".ngrok.io"
version: 1.0.0
kind: Scheduled
relevantTechniques:
- T1567
- T1572
- T1102
entityMappings:
- entityType: URL
  fieldMappings:
  - identifier: Url
    columnName: RemoteUrl
requiredDataConnectors:
- connectorId: MicrosoftThreatProtection
  dataTypes:
  - DeviceNetworkEvents
