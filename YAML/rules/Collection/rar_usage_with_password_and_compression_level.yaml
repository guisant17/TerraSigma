id: ce809fc1-caef-5cdb-bfda-0b70dee5537b
name: Rar Usage with Password and Compression Level
description: Detects the use of rar.exe, on the command line, to create an archive with password protection or with a specific compression level. This is pretty indicative of malicious actions. - Legitimate use of Winrar command line version - Other command line tools, that use these flags
severity: High
queryFrequency: PT1H
queryPeriod: PT1H
triggerOperator: gt
triggerThreshold: 0
tactics:
- Collection
query: |-
  DeviceProcessEvents
  | where ProcessCommandLine contains " -hp" and (ProcessCommandLine contains " -m" or ProcessCommandLine contains " a ")
version: 1.0.0
kind: Scheduled
relevantTechniques:
- T1560
entityMappings:
- entityType: Process
  fieldMappings:
  - identifier: CommandLine
    columnName: ProcessCommandLine
requiredDataConnectors:
- connectorId: MicrosoftThreatProtection
  dataTypes:
  - DeviceProcessEvents
