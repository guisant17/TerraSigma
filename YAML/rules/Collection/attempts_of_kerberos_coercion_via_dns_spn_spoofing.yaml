id: b4b0c9c1-7555-528a-ae60-2fa09aa8c0a5
name: Attempts of Kerberos Coercion Via DNS SPN Spoofing
description: Detects the presence of "UWhRC....AAYBAAAA" pattern in command line. The pattern "1UWhRCAAAAA..BAAAA" is a base64-encoded signature that corresponds to a marshaled CREDENTIAL_TARGET_INFORMATION structure. Attackers can use this technique to coerce authentication from victim systems to attacker-controlled hosts. It is one of the strong indicators of a Kerberos coercion attack, where adversaries manipulate DNS records to spoof Service Principal Names (SPNs) and redirect authentication requests like in CVE-2025-33073. If you see this pattern in the command line, it is likely an attempt to add spoofed Service Principal Names (SPNs) to DNS records, or checking for the presence of such records through the `nslookup` command.
severity: High
queryFrequency: PT1H
queryPeriod: PT1H
triggerOperator: gt
triggerThreshold: 0
tactics:
- Collection
- CredentialAccess
- Persistence
- PrivilegeEscalation
query: |-
  DeviceProcessEvents
  | where ProcessCommandLine contains "UWhRCA" and ProcessCommandLine contains "BAAAA"
version: 1.0.0
kind: Scheduled
relevantTechniques:
- T1557
- T1187
entityMappings:
- entityType: Process
  fieldMappings:
  - identifier: CommandLine
    columnName: ProcessCommandLine
requiredDataConnectors:
- connectorId: MicrosoftThreatProtection
  dataTypes:
  - DeviceProcessEvents
