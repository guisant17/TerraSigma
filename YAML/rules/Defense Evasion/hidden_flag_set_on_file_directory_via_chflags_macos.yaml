id: e29e5d08-7402-50df-8f34-bb6260dce190
name: Hidden Flag Set On File/Directory Via Chflags - MacOS
description: Detects the execution of the "chflags" utility with the "hidden" flag, in order to hide files on MacOS. When a file or directory has this hidden flag set, it becomes invisible to the default file listing commands and in graphical file browsers. - Legitimate usage of chflags by administrators and users.
severity: Medium
queryFrequency: PT1H
queryPeriod: PT1H
triggerOperator: gt
triggerThreshold: 0
tactics:
- DefenseEvasion
- CredentialAccess
- CommandAndControl
query: |-
  DeviceProcessEvents
  | where ProcessCommandLine contains "hidden " and FolderPath endswith "/chflags"
version: 1.0.0
kind: Scheduled
relevantTechniques:
- T1218
- T1564
- T1552
- T1105
entityMappings:
- entityType: Process
  fieldMappings:
  - identifier: CommandLine
    columnName: ProcessCommandLine
  - identifier: ProcessPath
    columnName: FolderPath
- entityType: File
  fieldMappings:
  - identifier: Directory
    columnName: FolderPath
requiredDataConnectors:
- connectorId: MicrosoftThreatProtection
  dataTypes:
  - DeviceProcessEvents
