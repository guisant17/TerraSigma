id: 6e1dd9b4-9179-56b0-9601-4c23e7c19021
name: New DNS ServerLevelPluginDll Installed
description: Detects the installation of a DNS plugin DLL via ServerLevelPluginDll parameter in registry, which can be used to execute code in context of the DNS server (restart required)
severity: High
queryFrequency: PT1H
queryPeriod: PT1H
triggerOperator: gt
triggerThreshold: 0
tactics:
- PrivilegeEscalation
- Persistence
- DefenseEvasion
query: |-
  DeviceRegistryEvents
  | where RegistryKey endswith "\\services\\DNS\\Parameters\\ServerLevelPluginDll"
version: 1.0.0
kind: Scheduled
relevantTechniques:
- T1574
- T1112
entityMappings:
- entityType: RegistryKey
  fieldMappings:
  - identifier: Key
    columnName: RegistryKey
requiredDataConnectors:
- connectorId: MicrosoftThreatProtection
  dataTypes:
  - DeviceRegistryEvents
